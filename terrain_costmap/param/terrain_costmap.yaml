# terrain_costmap parameters for DONKEYBOTI AMR
#
# [v2] Temporal smoothing — IIR filter reduces flickering
# [v3] Costmap-level inflation — exponential decay around obstacles
#      A* and DWA both see the inflated cost field

terrain_costmap_node:
  ros__parameters:
    # --- Costmap geometry ---
    costmap_size: 5.0          # [m] side length of square costmap
    costmap_resolution: 0.1    # [m] cell size
    robot_frame: "base_link"
    odom_frame: "odom"

    # --- Cost weights (sum ≈ 1.0) ---
    weight_obstacle: 0.45      # Non-ground point density
    weight_slope: 0.35         # Terrain inclination
    weight_roughness: 0.15     # Surface irregularity
    weight_unknown: 0.05       # Unobserved area

    # --- Thresholds ---
    slope_max_deg: 35.0        # [deg] slopes >= this → cost 1.0
    roughness_max: 0.05        # [m²] variance >= this → cost 1.0
    obstacle_count_max: 10.0   # points >= this → cost 1.0
    confidence_threshold: 0.3  # below this → "unknown"
    lethal_threshold: 0.8      # total cost >= this → 100 (impassable)

    # --- [v2] Temporal smoothing ---
    temporal_alpha: 0.3        # [0~1] lower = smoother
    temporal_obstacle_persist: 3  # frames obstacle persists after disappearing

    # --- [v3] Costmap inflation ---
    # Exponential cost decay around lethal (>=90) cells
    # cost = 89 * exp(-decay_rate * distance / radius)
    #
    # inflation_radius: how far the cost spreads [m]
    #   0.8m = 8 cells at 0.1m resolution
    #   Larger = paths stay further from walls
    #
    # inflation_decay_rate: how fast cost drops with distance
    #   2.5 = moderate (cost ~7 at edge)
    #   1.5 = slow decay (cost ~20 at edge — wider safe zone)
    #   4.0 = fast decay (cost ~2 at edge — narrow buffer)
    #
    # inflation_lethal_cost: cells >= this value trigger inflation
    #   Should match astar_lethal_cost in path_planner
    inflation_radius: 0.8          # [m]
    inflation_decay_rate: 2.0      # exponential steepness
    inflation_lethal_cost: 90      # cells >= this get inflated

    # --- Persistent terrain accumulation ---
    enable_terrain_accumulation: true
    terrain_max_points: 200000
    terrain_radius: 10.0
    terrain_publish_rate: 1.0

    # --- Topics ---
    gridmap_topic: "/groundgrid/grid_map"
    filtered_cloud_topic: "/groundgrid/filtered_cloud"
    costmap_topic: "/terrain_costmap"
    terrain_cloud_topic: "/terrain_costmap/terrain_cloud"